<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/white.css" />
    <link rel="stylesheet" href="css/stylesheet.css" />
    <link rel="stylesheet" href="css/animate.min.css" />
    <!-- theme used for syntax highlighted code -->
    <link rel="stylesheet" href="./css/dracula.css" />
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-transition="none" data-background-transition="none">
          <h1>Мультиметоды и полиморфизм в JavaScript:</h1>
          <p>мощные техники для гибкого кода</p>
        </section>
        <section
          data-me="true"
          data-background-color="#676b6b"
          data-transition="none"
          data-background-transition="none"
        >
          <h1 data-addclass="animate__animated animate__bounceindown">
            Алексей Золотых
          </h1>
          <p class="fragment fade-up">инженер</p>
          <p class="fragment fade-up">тимлид</p>
          <p class="fragment fade-up">спикер</p>
        </section>
        <section>
          <img src="./img/logo.svg" style="height: 50vh" alt="" />
        </section>
        <section
          data-background-image="./img/myoffice.png"
          data-background-position="top"
        ></section>
        <section>
          <h2>команда веб-редакторов</h2>
          <img src="./img/office.png" alt="" />
        </section>
        <section>
          <img src="./img/holyjs.svg" style="height: 50vh" alt="" />
        </section>
        <section data-transition="none" data-background-transition="none">
          <h1>Мультиметоды и полиморфизм в JavaScript:</h1>
          <p>мощные техники для гибкого кода</p>
        </section>
        <section data-transition="none" data-background-transition="none">
          <div class="r-stack">
            <div class="animate__animated" data-addclass="animate__hinge">
              <h1>Мультиметоды и полиморфизм в JavaScript:</h1>
              <p>мощные техники для гибкого кода</p>
            </div>
            <blockquote
              cite=""
              data-addclass="animate__animated"
              class="animate__fadein animate__delay-3s"
            >
              <p>
                Programs must be written for people to read, and only
                incidentally for machines to execute
              </p>
              <p>
                &mdash; Abelson & Sussman, SICP, preface to the first edition
              </p>
            </blockquote>
          </div>
        </section>
        <section>
          <h2 class="r-fit-text">Наши возможности очень малы</h2>
          <h2 class="fragment">5 &plusmn; 2</h2>
        </section>
        <section>
          <h2>Нам сложно читать код</h2>
        </section>
        <section>
          <h2 class="r-fit-text">
            Cognitive Complexity (Cyclomatic Complexity)
          </h2>
          <pre><code class="js" data-trim>
function example(x) {
  // +1 (if)
  if (x &gt; 0) {                       
    // +1 (if) +1 (вложенность)
    if (x &lt; 10) {                    
      // +1 (for) +1 (вложенность)
      for (let i = 0; i &lt; 10; i++) { 
        // +1 (if) +1 (вложенность) +1 (return)
        if (i === x) return; 
      }
    }
  }
}
          </code></pre>
        </section>
        <section>
          <h2>Много if &mdash; плохо</h2>
        </section>
        <section data-transition="slide none">
          <h2>Чем плох код?</h2>
          <pre><code data-trim style="font-size: 0.7em; line-height: 1.3em">
function renderWidget(widget) {
  if (widget.type === &quot;dashboard&quot;) {
    return `&lt;div class=&quot;dashboard&quot;&gt;${widget.data.summary}&lt;/div&gt;`;
  } else if (widget.type === &quot;chart&quot;) {
    return `&lt;canvas class=&quot;chart&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else {
    console.warn(&quot;Unsupported widget configuration:&quot;, widget);
    return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
  }
}
          </code></pre>
        </section>
        <section>
          <h2>S<mark>O</mark>LID</h2>
          <p class="fragment">open–closed principle (OCP)</p>
          <p class="fragment">сущности должны быть открыты для расширения, но закрыты для модификации</p>
        </section>
        <section>
          <h2 class="r-fit-text">Open–closed principle</h2>
          <ul>
            <li>Снижение риска ошибок</li>
            <li>Упрощение поддержки</li>
            <li>Сокращение конфликтов при слиянии кода</li>
            <li>Гибкость</li>
          </ul>
        </section>
        <section data-transition="slide none">
          <h2>Чем плох код?</h2>
          <pre><code data-trim style="font-size: 0.7em; line-height: 1.3em">
function renderWidget(widget) {
  if (widget.type === &quot;dashboard&quot;) {
    return `&lt;div class=&quot;dashboard&quot;&gt;${widget.data.summary}&lt;/div&gt;`;
  } else if (widget.type === &quot;chart&quot;) {
    return `&lt;canvas class=&quot;chart&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else {
    console.warn(&quot;Unsupported widget configuration:&quot;, widget);
    return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
  }
}
          </code></pre>
        </section>
        <section data-transition="slide none">
          <h2>Чем плох код?</h2>
          <pre><code data-trim style="font-size: 0.7em; line-height: 1.3em" data-line-numbers="6-7">
function renderWidget(widget) {
  if (widget.type === &quot;dashboard&quot;) {
    return `&lt;div class=&quot;dashboard&quot;&gt;${widget.data.summary}&lt;/div&gt;`;
  } else if (widget.type === &quot;chart&quot;) {
    return `&lt;canvas class=&quot;chart&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else if (widget.type === &quot;superchart&quot;) {
    return `&lt;canvas class=&quot;superchart&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else {
    console.warn(&quot;Unsupported widget configuration:&quot;, widget);
    return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
  }
}
          </code></pre>
        </section>
        <section>
          <h2>Решение</h2>
          <pre><code class="javascript" data-trim data-line-numbers="1-13|2-6|8|10-12|15-33">
function renderWidget(widget) {
  const widgetRenderers = {
    dashboard: renderDashboardWidget,
    chart: renderChartWidget,
    superchart: renderSuperChartWidget
  };

  const renderer = widgetRenderers[widget.type];
  
  return renderer 
    ? renderer(widget.data)
    : handleUnsupportedWidget(widget);
}

function renderDashboardWidget(data) {
  return `<div class="dashboard">${data.summary}</div>`;
}

function renderChartWidget(data) {
  return createCanvasElement('chart', data.config);
}

function renderSuperChartWidget(data) {
  return createCanvasElement('superchart', data.config);
}

function createCanvasElement(className, config) {
  return `<canvas class="${className}" data-config="${config}"></canvas>`;
}

function handleUnsupportedWidget(widget) {
  console.warn("Unsupported widget configuration:", widget);
  return `<div>Unsupported widget</div>`;
}
          </code></pre>
        </section>
        <section
          <h2>Что может пойти не так!?</h2>
        </section>
        <section>
          <h2>Множественные условия</h2>
          <pre><code data-trim class="javascript" data-line-numbers="1-29|2-6|14-16,18">
function renderWidget(widget, userRole, theme) {
  if (widget.type === &quot;dashboard&quot; &amp;&amp; 
      userRole === &quot;admin&quot; &amp;&amp; 
      theme === &quot;dark&quot;
  ) {
    return `&lt;div class=&quot;dashboard dark admin&quot;&gt;${widget.data.summary}&lt;/div&gt;`;
  } else if (
    widget.type === &quot;dashboard&quot; &amp;&amp;
    userRole === &quot;user&quot; &amp;&amp;
    theme === &quot;dark&quot;
  ) {
    return `&lt;div class=&quot;dashboard dark user&quot;&gt;${widget.data.summary}&lt;/div&gt;`;
  } else if (
    widget.type === &quot;chart&quot; &amp;&amp;
    userRole === &quot;admin&quot; &amp;&amp;
    theme === &quot;light&quot;
  ) {
    return `&lt;canvas class=&quot;chart light admin&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else if (
    widget.type === &quot;chart&quot; &amp;&amp;
    userRole === &quot;user&quot; &amp;&amp;
    theme === &quot;light&quot;
  ) {
    return `&lt;canvas class=&quot;chart light user&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`;
  } else {
    console.warn(&quot;Unsupported widget configuration:&quot;, widget, userRole, theme);
    return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
            }
  }
          </code></pre>
        </section>
        <section>
          <h2>Можно сделать так</h2>
          <pre><code class="javascript">
function renderWidget(widget, userRole, theme) {
  const { type, data } = widget;
  const classList = `${type} ${theme} ${userRole}`;

  if (type === &#39;dashboard&#39;) {
    return `&lt;div class=&quot;${classList}&quot;&gt;${data.summary}&lt;/div&gt;`;
  }

  if (type === &#39;chart&#39;) {
    return `&lt;canvas class=&quot;${classList}&quot; data-config=&quot;${data.config}&quot;&gt;&lt;/canvas&gt;`;
  }

  console.warn(&quot;Unsupported widget configuration:&quot;, widget, userRole, theme);
  return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
}
          </code></pre>
        </section>
        <section>
          <h2 class="r-fit-text">Чуть меняем функцию рендера</h2>
          <pre><code class="javascript" data-trim data-line-numbers="1-11|2|3|5-7|9-10">
function renderWidget(widget, userRole, theme) {
  const handlerKey = `${widget.type}-${userRole}-${theme}`;
  const handler = widgetHandlers[handlerKey];
  
  if (handler) {
    return handler(widget);
  }
  
  console.warn(&quot;Unsupported widget configuration:&quot;, widget, userRole, theme);
  return `&lt;div&gt;Unsupported widget&lt;/div&gt;`;
}
          </code></pre>
        </section>
        <section>
          <h2 class="r-fit-text">Используем составные ключи</h2>
          <pre><code data-trim class="javascript">
const widgetHandlers = {
  &#39;dashboard-admin-dark&#39;: (widget) =&gt; 
    `&lt;div class=&quot;dashboard dark admin&quot;&gt;${widget.data.summary}&lt;/div&gt;`,
  
  &#39;dashboard-user-dark&#39;: (widget) =&gt; 
    `&lt;div class=&quot;dashboard dark user&quot;&gt;${widget.data.summary}&lt;/div&gt;`,
  
  &#39;chart-admin-light&#39;: (widget) =&gt; 
    `&lt;canvas class=&quot;chart light admin&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`,
  
  &#39;chart-user-light&#39;: (widget) =&gt; 
    `&lt;canvas class=&quot;chart light user&quot; data-config=&quot;${widget.data.config}&quot;&gt;&lt;/canvas&gt;`
};
          </code></pre>
        </section>
       <section>
         <h2>Использование</h2>
         <pre><code data-trim class="javascript">
const myWidget = {
  type: &quot;chart&quot;,
  data: { config: &quot;chart_config.json&quot; }
};

// &lt;canvas class=&quot;chart light admin&quot; data-config=&quot;chart_config.json&quot;&gt;&lt;/canvas&gt;
renderWidget(myWidget, &quot;admin&quot;, &quot;light&quot;);
          </code></pre>
       </section>
        <section style="text-align: left">
          <p>&mdash; Что опять не так!?</p>
          <p class="fragment">&mdash; Как можно это переиспользовать?</p>
        </section>
        <section>
          <h2>Как должен выглядеть API</h2>
          <pre><code class="javascript" data-trim data-line-numbers="1-13|1-6|8-13">
const renderWidget = createMultiMethod()
  .def(&quot;dashboard-admin-dark&quot;, (widget) =&gt; ...)
  .def(&quot;dashboard-user-dark&quot;, (widget) =&gt; ...)
  .def(&quot;chart-admin-light&quot;, (widget) =&gt; ...)
  .def(&quot;chart-user-light&quot;, (widget) =&gt; ...)
  .def(&quot;*&quot;, (widget) =&gt; `&lt;div&gt;Unsupported widget&lt;/div&gt;`);

const chartWidget = {
  type: &quot;chart&quot;,
  data: { config: &quot;chart.json&quot; }
};

console.log(renderWidget(chartWidget, &quot;admin&quot;, &quot;light&quot;));
          </code></pre>
        </section>
        <section>
          <pre><code data-trim class="javascript">
function createMultiMethod() {
  const multiMethod = (...args) =&gt; {
  };

  multiMethod.def = (key, impl) =&gt; {
    return multiMethod;
  };

  return multiMethod;
}
          </code></pre>
        </section>
        <section>
          <pre><code>
function createMultiMethod() {
  const methods = {};

  const multiMethod = (...args) =&gt; {
    const key = args.join(&quot; &quot;);
    if (key in methods) {
      return methods[key](...args);
    }
    if (&quot;*&quot; in methods) {
      return methods[&quot;*&quot;](...args); // fallback
    }
    throw new Error(&quot;No matching method&quot;);
  };

  multiMethod.def = (key, impl) =&gt; {
    methods[key] = impl;
    return multiMethod;
  };

  return multiMethod;
}
          </code></pre>
        </section>
      </div>
    </div>
    <img
      class="js-me animate__slideInUp"
      src="./img/me.png"
      alt="speaker photo"
      style="
        height: 70vh;
        position: fixed;
        bottom: 0;
        right: 50%;
        display: none;
      "
    />
    <img
      class="js-nik animate__slideInRight"
      src="./img/nikolaev.png"
      alt="speaker photo"
      style="height: 70vh; position: fixed; bottom: 0; right: 0%; display: none"
    />

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/math/math.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealNotes,
          RevealMath.KaTeX,
        ],
      });

      Reveal.on("slidechanged", (event) => {
        const image = document.querySelector(".js-me");
        const showImage = event.currentSlide.dataset["me"];
        image.style.display = showImage ? "block" : "none";
        if (showImage) {
          image.classList.add("animate__animated");
        } else {
          image.classList.remove("animate__animated");
        }
      });

      Reveal.on("slidechanged", (event) => {
        const image = document.querySelector(".js-nik");
        const showImage = event.currentSlide.dataset["nik"];
        image.style.display = showImage ? "block" : "none";
        if (showImage) {
          image.classList.add("animate__animated");
        } else {
          image.classList.remove("animate__animated");
        }
      });

      Reveal.on("slidechanged", (event) => {
        event.previousSlide
          ?.querySelectorAll("[data-addclass]")
          .forEach((el) => {
            const classNames = el.dataset["addclass"].split(" ");
            el.classList.remove(...classNames);
          });
        event.currentSlide.querySelectorAll("[data-addclass]").forEach((el) => {
          const delay = el.dataset["addclassDelay"];
          const classNames = el.dataset["addclass"].split(" ");
          setTimeout(
            () => el.classList.add(...classNames),
            delay ? parseInt(delay, 10) : 0,
          );
        });
      });
    </script>
  </body>
</html>
